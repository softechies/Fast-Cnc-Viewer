import{u as $,r as o,j as e,T as H,a as P,b as I,c as T,C as E,d as M,S as U,B as W}from"./index-BGMVhg8j.js";function Z({modelId:g,isPublic:J,publicId:K}){const{t:a}=$(),[x,q]=o.useState(null),[A,p]=o.useState(!1),[b,S]=o.useState(null),u=o.useRef(null),[n,f]=o.useState(null);function G(){if(!u.current)return;const s=u.current.querySelector("svg");if(!s)return;const V=s.querySelector("#entities")||s;try{const l=s.getAttribute("data-units")||"mm",X=s.getAttribute("viewBox");if(X){const[i,t,r,_]=X.split(" "),w=parseFloat(i),y=parseFloat(t),j=parseFloat(r),N=parseFloat(_),z=w+j,D=y+N;f({width:j,height:N,minX:w,minY:y,maxX:z,maxY:D,units:l}),console.log("Wymiary modelu DXF (z viewBox):",{width:j,height:N,units:l,minX:w,minY:y,maxX:z,maxY:D});return}const Y=s.getAttribute("width"),F=s.getAttribute("height");if(Y&&F){const i=parseFloat(Y),t=parseFloat(F);if(!isNaN(i)&&!isNaN(t)){f({width:i,height:t,minX:0,minY:0,maxX:i,maxY:t,units:l}),console.log("Wymiary modelu DXF (z atrybutów width/height):",{width:i,height:t,units:l,minX:0,minY:0,maxX:i,maxY:t});return}}let c=1/0,d=1/0,m=-1/0,h=-1/0;const R=(s.querySelector("#content")||s.querySelector("#modelspace")||V).querySelectorAll("path, line, circle, rect, polyline, polygon");let v=0;if(R.forEach(i=>{try{const t=i.getBBox();v++,c=Math.min(c,t.x),d=Math.min(d,t.y),m=Math.max(m,t.x+t.width),h=Math.max(h,t.y+t.height)}catch{console.log("Pominięto element bez getBBox:",i.tagName)}}),c===1/0||d===1/0||m===-1/0||h===-1/0||v===0){console.log("Nie można obliczyć wymiarów modelu - brak elementów z wymiarami");const i=window.getComputedStyle(s),t=parseFloat(i.width),r=parseFloat(i.height);!isNaN(t)&&!isNaN(r)&&t>0&&r>0&&(f({width:t,height:r,minX:0,minY:0,maxX:t,maxY:r,units:l}),console.log("Wymiary modelu DXF (z CSS):",{width:t,height:r,units:l,minX:0,minY:0,maxX:t,maxY:r}));return}const B=m-c,C=h-d;f({width:B,height:C,minX:c,minY:d,maxX:m,maxY:h,units:l}),console.log("Wymiary modelu DXF (obliczone z elementów):",{width:B,height:C,units:l,minX:c,minY:d,maxX:m,maxY:h,elements:v})}catch(l){console.error("Błąd podczas obliczania wymiarów SVG:",l)}}o.useEffect(()=>{g&&(p(!0),S(null),fetch(`/api/models/${g}/svg`).then(s=>{if(!s.ok)throw new Error(`Błąd ${s.status}: ${s.statusText}`);return s.text()}).then(s=>{q(s),p(!1)}).catch(s=>{console.error("Błąd pobierania SVG:",s),S(s.message),p(!1)}))},[g]),o.useEffect(()=>{x&&u.current&&setTimeout(()=>{G()},100)},[x]);const L=()=>A?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(U,{className:"h-32 w-32 rounded-full"})}):b?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[e.jsx(W,{variant:"destructive",className:"mb-2",children:a("error")}),e.jsx("p",{className:"text-sm text-gray-500",children:b})]}):x?e.jsx("div",{ref:u,className:"w-full h-full flex items-center justify-center relative",dangerouslySetInnerHTML:{__html:x}}):e.jsx("div",{className:"flex items-center justify-center h-full text-center p-4",children:e.jsx("p",{className:"text-sm text-gray-500",children:a("dxf.no_preview")})}),k=()=>n?e.jsxs("div",{className:"p-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-2 text-sm",children:a("dimensions.title")}),e.jsxs("div",{className:"grid grid-cols-2 gap-y-1 gap-x-4 text-xs",children:[e.jsxs("div",{className:"text-gray-500",children:[a("dimensions.width"),":"]}),e.jsxs("div",{className:"font-medium text-right",children:[n.width.toFixed(2)," ",n.units]}),e.jsxs("div",{className:"text-gray-500",children:[a("dimensions.height"),":"]}),e.jsxs("div",{className:"font-medium text-right",children:[n.height.toFixed(2)," ",n.units]}),e.jsx("div",{className:"col-span-2 mt-2",children:e.jsx(W,{variant:"outline",className:"text-xs",children:n.units.toUpperCase()})})]})]}):null;return e.jsx("div",{className:"h-full w-full flex flex-col",children:e.jsxs(H,{defaultValue:"preview",className:"flex-1 flex flex-col",children:[e.jsxs(P,{className:"w-full",children:[e.jsx(I,{value:"preview",children:a("preview")}),e.jsx(I,{value:"info",children:a("details")})]}),e.jsx(T,{value:"preview",className:"flex-1 min-h-0 relative",children:e.jsx(E,{className:"h-full border-t-0 rounded-t-none flex flex-col",children:e.jsx(M,{className:"flex-1 p-0 relative",children:e.jsxs("div",{className:"w-full h-full relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:L()}),n&&e.jsx("div",{className:"absolute bottom-2 left-2 z-10 bg-black/70 text-white text-xs p-2 rounded",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-2",children:[e.jsxs("span",{children:[a("dimensions.width"),":"]}),e.jsxs("span",{className:"font-bold",children:[n.width.toFixed(2)," ",n.units]}),e.jsxs("span",{children:[a("dimensions.height"),":"]}),e.jsxs("span",{className:"font-bold",children:[n.height.toFixed(2)," ",n.units]})]})})]})})})}),e.jsx(T,{value:"info",children:e.jsx(E,{className:"border-t-0 rounded-t-none",children:e.jsx(M,{className:"pt-4",children:e.jsx("div",{className:"space-y-4",children:k()})})})})]})})}export{Z as default};
